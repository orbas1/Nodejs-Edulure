# ------------------------
# Core service metadata
# ------------------------
NODE_ENV=development
PORT=4000
APP_NAME=Edulure
APP_URL=http://localhost:5173

# ------------------------
# CORS & HTTP surface
# ------------------------
CORS_ALLOWED_ORIGINS=http://localhost:5173
CORS_ALLOWED_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Authorization,Content-Type,X-Requested-With,X-Correlation-Id,X-Csrf-Token
CORS_ALLOW_CREDENTIALS=true
CORS_MAX_AGE_SECONDS=600
TRACE_HEADER_NAME=x-request-id
TRACING_SAMPLE_RATE=0.25

# ------------------------
# Authentication & account security
# ------------------------
# Provide either JWT_KEYSET/JWT_ACTIVE_KEY_ID (preferred) or JWT_SECRET for legacy setups.
JWT_KEYSET=
JWT_ACTIVE_KEY_ID=
JWT_SECRET=change-me-super-secret-please-rotate
JWT_REFRESH_SECRET=change-me-refresh-secret-please-rotate
JWT_AUDIENCE=api.edulure.com
JWT_ISSUER=edulure-platform
TOKEN_EXPIRY_MINUTES=120
REFRESH_TOKEN_EXPIRY_DAYS=30
TWO_FACTOR_REQUIRED_ROLES=admin
TWO_FACTOR_DIGITS=6
TWO_FACTOR_CHALLENGE_TTL_SECONDS=300
TWO_FACTOR_RESEND_COOLDOWN_SECONDS=60
TWO_FACTOR_MAX_ATTEMPTS=5
ACCOUNT_LOCKOUT_THRESHOLD=5
ACCOUNT_LOCKOUT_WINDOW_MINUTES=15
ACCOUNT_LOCKOUT_DURATION_MINUTES=30
RATE_LIMIT_WINDOW_MINUTES=15
RATE_LIMIT_MAX=300
SESSION_VALIDATION_CACHE_TTL_MS=60000
MAX_ACTIVE_SESSIONS_PER_USER=10

# ------------------------
# Data encryption & classification
# ------------------------
DATA_ENCRYPTION_PRIMARY_KEY=local-development-primary-key-32chars!!
DATA_ENCRYPTION_ACTIVE_KEY_ID=local-primary
# Comma separated list formatted as keyId:secret
DATA_ENCRYPTION_FALLBACK_KEYS=legacy-2023:legacy-fallback-secret-value-rotate
DATA_ENCRYPTION_DEFAULT_CLASSIFICATION=restricted

# ------------------------
# Logging & audit trails
# ------------------------
LOG_LEVEL=info
LOG_SERVICE_NAME=edulure-api
LOG_REDACTED_FIELDS=req.body.ssn,req.body.pin
AUDIT_LOG_TENANT_ID=global
AUDIT_LOG_DEFAULT_SEVERITY=info
AUDIT_LOG_ALLOWED_EVENT_TYPES=login,security,governance
AUDIT_LOG_ENABLE_IP_CAPTURE=true
AUDIT_LOG_IP_CLASSIFICATION=restricted
AUDIT_LOG_MAX_METADATA_BYTES=4096
AUDIT_LOG_METADATA_REDACT_KEYS=password,secret,token
AUDIT_LOG_INCLUDE_REQUEST_CONTEXT=true

# ------------------------
# Database connectivity
# ------------------------
DB_HOST=localhost
DB_PORT=3306
DB_USER=edulure_local
DB_PASSWORD=super-secure-password
DB_NAME=edulure
DB_PROVISION_USER=true
DB_USER_HOST=%
DB_ROOT_USER=root
DB_ROOT_PASSWORD=changeme
DB_POOL_MIN=2
DB_POOL_MAX=10

# ------------------------
# Observability & SLOs
# ------------------------
METRICS_ENABLED=true
METRICS_USERNAME=metrics
METRICS_PASSWORD=metrics-pass-123
# METRICS_BEARER_TOKEN=dev-metrics-bearer-token-1234
METRICS_ALLOWED_IPS=127.0.0.1/32,::1
SLO_CONFIG=
SLO_BUCKET_MINUTES=1
SLO_WINDOW_MINUTES=60
SLO_LATENCY_SAMPLE_SIZE=512
SLO_DEFAULT_AVAILABILITY_TARGET=0.995
SLO_WARNING_BURN_RATE=4
SLO_CRITICAL_BURN_RATE=10
SLO_MIN_REQUESTS=200
SLO_DEFAULT_TREAT_4XX_AS_FAILURE=false

# ------------------------
# Redis cache for runtime controls (optional)
# ------------------------
REDIS_ENABLED=false
REDIS_URL=redis://127.0.0.1:6379
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
REDIS_USERNAME=default
REDIS_PASSWORD=redis-password
REDIS_TLS_ENABLED=false
REDIS_TLS_CA=
REDIS_KEY_PREFIX=edulure:runtime
REDIS_LOCK_PREFIX=edulure:locks
REDIS_FEATURE_FLAG_CACHE_KEY=feature-flags
REDIS_RUNTIME_CONFIG_CACHE_KEY=runtime-config
REDIS_FEATURE_FLAG_LOCK_KEY=feature-flags
REDIS_RUNTIME_CONFIG_LOCK_KEY=runtime-config
REDIS_COMMAND_TIMEOUT_MS=2000
REDIS_LOCK_TTL_SECONDS=45

# ------------------------
# Feature flags & runtime configuration
# ------------------------
FEATURE_FLAG_CACHE_TTL_SECONDS=30
FEATURE_FLAG_REFRESH_INTERVAL_SECONDS=120
FEATURE_FLAG_SYNC_ON_BOOT=true
FEATURE_FLAG_SYNC_ACTOR=bootstrap-automation
FEATURE_FLAG_DEFAULT_ENVIRONMENT=production
RUNTIME_CONFIG_CACHE_TTL_SECONDS=45
RUNTIME_CONFIG_REFRESH_INTERVAL_SECONDS=300

# ------------------------
# Storage, antivirus & content pipeline
# ------------------------
ASSET_STORAGE_DRIVER=local
LOCAL_STORAGE_ROOT=./storage/local
LOCAL_STORAGE_PUBLIC_URL=http://localhost:4000/storage
LOCAL_STORAGE_SERVE_STATIC=true
R2_ACCOUNT_ID=
R2_ACCESS_KEY_ID=
R2_SECRET_ACCESS_KEY=
R2_REGION=auto
R2_PUBLIC_BUCKET=edulure-public
R2_PRIVATE_BUCKET=edulure-private
R2_UPLOADS_BUCKET=edulure-uploads
R2_QUARANTINE_BUCKET=edulure-quarantine
R2_CDN_URL=https://cdn.edulure.com
ASSET_PRESIGN_TTL_MINUTES=15
ASSET_DOWNLOAD_TTL_MINUTES=60
CONTENT_MAX_UPLOAD_MB=512
ANTIVIRUS_ENABLED=true
ANTIVIRUS_HOST=127.0.0.1
ANTIVIRUS_PORT=3310
ANTIVIRUS_TIMEOUT_MS=20000
ANTIVIRUS_MAX_FILE_SIZE_MB=500
ANTIVIRUS_FAIL_OPEN=false
ANTIVIRUS_CACHE_TTL_SECONDS=300
ANTIVIRUS_SKIP_TAG=edulure-skip-scan
CLOUDCONVERT_API_KEY=your-cloudconvert-api-key
CLOUDCONVERT_SANDBOX_API_KEY=sandbox-api-key
CLOUDCONVERT_BASE_URL=https://api.cloudconvert.com/v2
CLOUDCONVERT_SANDBOX_MODE=false
CLOUDCONVERT_TIMEOUT_MS=15000
CLOUDCONVERT_RETRY_ATTEMPTS=3
CLOUDCONVERT_RETRY_BASE_DELAY_MS=500
CLOUDCONVERT_CIRCUIT_BREAKER_THRESHOLD=6
CLOUDCONVERT_CIRCUIT_BREAKER_COOLDOWN_SECONDS=180
DRM_DOWNLOAD_LIMIT=3
DRM_SIGNATURE_SECRET=local-drm-signature-secret-32-chars!!

# ------------------------
# Email & communications
# ------------------------
SMTP_HOST=smtp.mailtrap.io
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your-smtp-user
SMTP_PASSWORD=your-smtp-password
SMTP_FROM_EMAIL=security@edulure.com
SMTP_FROM_NAME="Edulure Security"
EMAIL_VERIFICATION_URL=https://app.edulure.com/auth/verify-email
EMAIL_VERIFICATION_TOKEN_TTL_MINUTES=60
EMAIL_VERIFICATION_RESEND_COOLDOWN_MINUTES=15
INTEGRATION_KEY_INVITE_BASE_URL=https://ops.edulure.com
INTEGRATION_KEY_INVITE_TTL_HOURS=72
TWILIO_ENVIRONMENT=sandbox
TWILIO_ACCOUNT_SID=AC000000000000000000000000000000
TWILIO_AUTH_TOKEN=000000000000000000000000000000
TWILIO_MESSAGING_SERVICE_SID=MG000000000000000000000000000000
TWILIO_FROM_NUMBER=
TWILIO_SANDBOX_FROM_NUMBER=+15005550006
TWILIO_RETRY_ATTEMPTS=3
TWILIO_RETRY_BASE_DELAY_MS=500
TWILIO_CIRCUIT_BREAKER_THRESHOLD=5
TWILIO_CIRCUIT_BREAKER_COOLDOWN_SECONDS=180

# ------------------------
# Payments & monetisation
# ------------------------
STRIPE_MODE=test
STRIPE_SECRET_KEY=sk_test_change_me
STRIPE_PUBLISHABLE_KEY=pk_test_change_me
STRIPE_WEBHOOK_SECRET=whsec_change_me
STRIPE_SANDBOX_SECRET_KEY=sk_test_change_me
STRIPE_SANDBOX_PUBLISHABLE_KEY=pk_test_change_me
STRIPE_SANDBOX_WEBHOOK_SECRET=whsec_change_me
STRIPE_RETRY_ATTEMPTS=3
STRIPE_RETRY_BASE_DELAY_MS=250
STRIPE_CIRCUIT_BREAKER_THRESHOLD=8
STRIPE_CIRCUIT_BREAKER_COOLDOWN_SECONDS=180
STRIPE_WEBHOOK_DEDUPE_TTL_SECONDS=86400
STRIPE_WEBHOOK_MAX_SKEW_SECONDS=1800
STRIPE_STATEMENT_DESCRIPTOR="EDULURE LEARNING"
ESCROW_API_KEY=escrow-api-key
ESCROW_API_SECRET=escrow-api-secret
ESCROW_BASE_URL=https://api.escrow.com/2017-09-01
ESCROW_WEBHOOK_SECRET=escrow-webhook-secret
PAYPAL_ENVIRONMENT=sandbox
PAYPAL_CLIENT_ID=paypal-sandbox-client-id
PAYPAL_CLIENT_SECRET=paypal-sandbox-client-secret
PAYPAL_SANDBOX_CLIENT_ID=paypal-sandbox-client-id
PAYPAL_SANDBOX_CLIENT_SECRET=paypal-sandbox-client-secret
PAYPAL_RETRY_ATTEMPTS=3
PAYPAL_RETRY_BASE_DELAY_MS=400
PAYPAL_CIRCUIT_BREAKER_THRESHOLD=6
PAYPAL_CIRCUIT_BREAKER_COOLDOWN_SECONDS=240
PAYPAL_WEBHOOK_DEDUPE_TTL_SECONDS=86400
PAYPAL_WEBHOOK_MAX_SKEW_SECONDS=3600
PAYPAL_WEBHOOK_ID=WH-1234567890
PAYMENTS_DEFAULT_CURRENCY=USD
PAYMENTS_ALLOWED_CURRENCIES=USD,EUR,GBP
PAYMENTS_TAX_TABLE={"US":{"defaultRate":0.07},"GB":{"defaultRate":0.2}}
PAYMENTS_TAX_INCLUSIVE=false
PAYMENTS_MINIMUM_TAX_RATE=0.00
PAYMENTS_MAX_COUPON_PERCENTAGE=80
PAYMENTS_REPORTING_TIMEZONE=Etc/UTC
MONETIZATION_RECONCILIATION_ENABLED=true
MONETIZATION_RECONCILIATION_CRON=5 * * * *
MONETIZATION_RECONCILIATION_TIMEZONE=Etc/UTC
MONETIZATION_RECONCILIATION_RUN_ON_STARTUP=true
MONETIZATION_RECOGNITION_WINDOW_DAYS=30
MONETIZATION_RECONCILIATION_TENANTS=
MONETIZATION_RECONCILIATION_TENANT_CACHE_MINUTES=30

# ------------------------
# CRM & partner integrations
# ------------------------
HUBSPOT_ENABLED=false
HUBSPOT_PRIVATE_APP_TOKEN=pat-1234567890abcdef123
HUBSPOT_BASE_URL=https://api.hubapi.com
HUBSPOT_TIMEOUT_MS=12000
HUBSPOT_MAX_RETRIES=3
HUBSPOT_SYNC_WINDOW_MINUTES=90
SALESFORCE_ENABLED=false
SALESFORCE_LOGIN_URL=https://login.salesforce.com
SALESFORCE_CLIENT_ID=sf-client-12345
SALESFORCE_CLIENT_SECRET=sf-secret-12345
SALESFORCE_USERNAME=sf.user@example.com
SALESFORCE_PASSWORD=sfpass123
SALESFORCE_SECURITY_TOKEN=
SALESFORCE_TIMEOUT_MS=12000
SALESFORCE_MAX_RETRIES=3
SALESFORCE_EXTERNAL_ID_FIELD=Edulure_Project_Id__c
CRM_HUBSPOT_SYNC_CRON=
CRM_SALESFORCE_SYNC_CRON=
CRM_RECONCILIATION_CRON=
CRM_RECONCILIATION_WINDOW_DAYS=7
CRM_MAX_CONCURRENT_JOBS=1

# ------------------------
# Telemetry & analytics pipeline
# ------------------------
TELEMETRY_INGESTION_ENABLED=true
TELEMETRY_ALLOWED_SOURCES=web,backend,worker
TELEMETRY_STRICT_SOURCE_ENFORCEMENT=false
TELEMETRY_DEFAULT_SCOPE=product.analytics
TELEMETRY_CONSENT_DEFAULT_VERSION=v1
TELEMETRY_CONSENT_HARD_BLOCK=true
TELEMETRY_EXPORT_ENABLED=true
TELEMETRY_EXPORT_DESTINATION=s3
TELEMETRY_EXPORT_BUCKET=edulure-telemetry
TELEMETRY_EXPORT_PREFIX=warehouse/telemetry
TELEMETRY_EXPORT_BATCH_SIZE=5000
TELEMETRY_EXPORT_COMPRESS=true
TELEMETRY_EXPORT_RUN_ON_STARTUP=true
TELEMETRY_EXPORT_CRON=*/10 * * * *
TELEMETRY_EXPORT_TIMEZONE=Etc/UTC
TELEMETRY_FRESHNESS_INGESTION_THRESHOLD_MINUTES=15
TELEMETRY_FRESHNESS_WAREHOUSE_THRESHOLD_MINUTES=30
TELEMETRY_LINEAGE_TOOL=dbt
TELEMETRY_LINEAGE_AUTO_RECORD=true

# ------------------------
# Community, chat & scheduling defaults
# ------------------------
COMMUNITY_DEFAULT_TIMEZONE=Etc/UTC
COMMUNITY_REMINDER_ENABLED=true
COMMUNITY_REMINDER_CRON=*/5 * * * *
COMMUNITY_REMINDER_TIMEZONE=Etc/UTC
COMMUNITY_REMINDER_LOOKAHEAD_MINUTES=30
COMMUNITY_REMINDER_BATCH_SIZE=100
CHAT_PRESENCE_DEFAULT_TTL_MINUTES=5
CHAT_PRESENCE_MAX_TTL_MINUTES=60
CHAT_MESSAGE_DEFAULT_PAGE_SIZE=50
CHAT_MESSAGE_MAX_PAGE_SIZE=200
DM_THREAD_DEFAULT_PAGE_SIZE=20
DM_THREAD_MAX_PAGE_SIZE=100
DM_MESSAGE_DEFAULT_PAGE_SIZE=50
DM_MESSAGE_MAX_PAGE_SIZE=200
SOCIAL_FOLLOW_DEFAULT_PAGE_SIZE=25
SOCIAL_FOLLOW_MAX_PAGE_SIZE=100
SOCIAL_RECOMMENDATION_MAX_RESULTS=12
SOCIAL_RECOMMENDATION_REFRESH_MINUTES=360
SOCIAL_MUTE_DEFAULT_DURATION_DAYS=30

# ------------------------
# Search & discovery
# ------------------------
MEILISEARCH_HOSTS=https://meilisearch-primary.edulure.internal:7700
MEILISEARCH_REPLICA_HOSTS=https://meilisearch-replica-a.edulure.internal:7700,https://meilisearch-replica-b.edulure.internal:7700
MEILISEARCH_SEARCH_HOSTS=https://meilisearch-primary.edulure.internal:7700
MEILISEARCH_ADMIN_API_KEY=replace-with-admin-key
MEILISEARCH_SEARCH_API_KEY=replace-with-search-only-key
MEILISEARCH_HEALTHCHECK_INTERVAL_SECONDS=30
MEILISEARCH_REQUEST_TIMEOUT_MS=5000
MEILISEARCH_INDEX_PREFIX=edulure
MEILISEARCH_ALLOWED_IPS=10.0.0.0/24,192.168.0.0/24
SEARCH_INGESTION_BATCH_SIZE=500
SEARCH_INGESTION_CONCURRENCY=2
SEARCH_INGESTION_DELETE_BEFORE_REINDEX=true

# ------------------------
# Governance jobs & eventing
# ------------------------
DATA_RETENTION_ENABLED=true
DATA_RETENTION_CRON=0 3 * * *
DATA_RETENTION_TIMEZONE=Etc/UTC
DATA_RETENTION_DRY_RUN=false
DATA_RETENTION_RUN_ON_STARTUP=false
DATA_RETENTION_MAX_FAILURES=3
DATA_RETENTION_FAILURE_BACKOFF_MINUTES=30
DATA_PARTITIONING_ENABLED=true
DATA_PARTITIONING_SCHEMA=
DATA_PARTITIONING_CRON=30 2 * * *
DATA_PARTITIONING_TIMEZONE=Etc/UTC
DATA_PARTITIONING_DRY_RUN=false
DATA_PARTITIONING_RUN_ON_STARTUP=false
DATA_PARTITIONING_LOOKAHEAD_MONTHS=6
DATA_PARTITIONING_LOOKBEHIND_MONTHS=1
DATA_PARTITIONING_MIN_ACTIVE_PARTITIONS=3
DATA_PARTITIONING_ARCHIVE_GRACE_DAYS=45
DATA_PARTITIONING_ARCHIVE_BUCKET=
DATA_PARTITIONING_ARCHIVE_PREFIX=
DATA_PARTITIONING_ARCHIVE_COMPRESS=false
DATA_PARTITIONING_EXPORT_BATCH_SIZE=5000
DATA_PARTITIONING_MAX_EXPORT_ROWS=2000
DATA_PARTITIONING_MAX_EXPORT_MB=128
DATA_PARTITIONING_MAX_FAILURES=3
DATA_PARTITIONING_FAILURE_BACKOFF_MINUTES=60
DOMAIN_EVENTS_DISPATCH_ENABLED=true
DOMAIN_EVENTS_DISPATCH_POLL_INTERVAL_MS=2000
DOMAIN_EVENTS_DISPATCH_BATCH_SIZE=50
DOMAIN_EVENTS_DISPATCH_MAX_ATTEMPTS=8
DOMAIN_EVENTS_DISPATCH_INITIAL_BACKOFF_SECONDS=30
DOMAIN_EVENTS_DISPATCH_MAX_BACKOFF_SECONDS=900
DOMAIN_EVENTS_DISPATCH_BACKOFF_MULTIPLIER=2
DOMAIN_EVENTS_DISPATCH_JITTER_RATIO=0.15
DOMAIN_EVENTS_DISPATCH_RECOVER_INTERVAL_MS=60000
DOMAIN_EVENTS_DISPATCH_RECOVER_TIMEOUT_MINUTES=10
WEBHOOK_BUS_ENABLED=true
WEBHOOK_BUS_POLL_INTERVAL_MS=2000
WEBHOOK_BUS_BATCH_SIZE=25
WEBHOOK_BUS_MAX_ATTEMPTS=6
WEBHOOK_BUS_INITIAL_BACKOFF_SECONDS=60
WEBHOOK_BUS_MAX_BACKOFF_SECONDS=1800
WEBHOOK_BUS_DELIVERY_TIMEOUT_MS=5000
WEBHOOK_BUS_RECOVER_AFTER_MS=300000

# ------------------------
# Environment metadata & release orchestration
# ------------------------
ENVIRONMENT_NAME=development
ENVIRONMENT_PROVIDER=aws
ENVIRONMENT_REGION=us-east-1
ENVIRONMENT_TIER=nonprod
ENVIRONMENT_DEPLOYMENT_STRATEGY=rolling
ENVIRONMENT_PARITY_BUDGET_MINUTES=30
ENVIRONMENT_INFRASTRUCTURE_OWNER=platform-team
ENVIRONMENT_REQUIRED_TAGS=
ENVIRONMENT_DEPENDENCIES=
ENVIRONMENT_ALLOWED_VPCS=
ENVIRONMENT_ALLOWED_ACCOUNT_IDS=
ENVIRONMENT_MANIFEST_PATH=
RELEASE_CHANNEL=rolling
RELEASE_REQUIRED_GATES=quality-verification,security-review,observability-health,compliance-evidence,change-approval
RELEASE_MIN_COVERAGE=0.9
RELEASE_MAX_TEST_FAILURE_RATE=0.02
RELEASE_MAX_CRITICAL_VULNERABILITIES=0
RELEASE_MAX_HIGH_VULNERABILITIES=5
RELEASE_MAX_OPEN_INCIDENTS=0
RELEASE_MAX_ERROR_RATE=0.01
RELEASE_CHANGE_FREEZE_CRON=0 22 * * 5

# ------------------------
# Bootstrap controls
# ------------------------
BOOTSTRAP_MAX_RETRIES=5
BOOTSTRAP_RETRY_DELAY_MS=2000
