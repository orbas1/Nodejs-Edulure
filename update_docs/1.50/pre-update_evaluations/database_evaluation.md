# Database Evaluation – Version 1.50

## Functionality
- **Schema breadth exceeds current operational capacity.** The initial migration provisions dozens of domains—users, communities, tutoring, live classes, field services, analytics, payments, KYC, content ingestion—in a single MySQL schema. This breadth demonstrates ambition but creates a tightly coupled data plane that is difficult to shard or deploy selectively for pilots.【F:backend-nodejs/migrations/20241010120000_initial_schema.js†L1-L198】
- **Retention and event sourcing tables lack ownership boundaries.** Domain event, analytics, and explorer metrics tables live alongside transactional tables without namespacing or partitioning, complicating backup strategies and making it hard to enforce GDPR policies per domain.【F:backend-nodejs/migrations/20241010120000_initial_schema.js†L70-L198】
- **Seeds assume full-platform deployment.** The bootstrap seed truncates nearly every table (ads, live classrooms, tutoring, ebooks, payments, KYC) before inserting demo data, preventing teams from reseeding a subset of modules or maintaining partial environments for specific customers.【F:backend-nodejs/seeds/001_bootstrap.js†L7-L198】
- **Knex configuration locks us into MySQL.** `knexfile.cjs` hard-fails when `.env` is missing and only defines a MySQL client, so standing up SQLite or Postgres for tests requires rewriting config rather than toggling per environment.【F:backend-nodejs/knexfile.cjs†L1-L32】
- **Critical indexes are missing for cross-domain queries.** High-volume tables such as `domain_events` and `field_service_events` index single columns but not common query patterns (e.g., `entity_type` + `event_type`, date ranges by tenant). Analytics workloads will require table scans across millions of rows.【F:backend-nodejs/migrations/20241010120000_initial_schema.js†L65-L198】

## Usability
- **Migrations favour idempotence over clarity.** Each table creation first checks `hasTable`, which protects reruns but obscures schema evolution because drop statements are omitted. Engineers must cross-reference the final schema manually to understand object lifecycles.【F:backend-nodejs/migrations/20241010120000_initial_schema.js†L1-L198】
- **Seed data is dense and undocumented.** The bootstrap transaction inserts admin, instructor, and learner personas with KYC records, hashed passwords, and policy references but lacks inline documentation or ERD diagrams, forcing newcomers to parse a 180+ line script to understand relationships.【F:backend-nodejs/seeds/001_bootstrap.js†L78-L198】
- **No migration rollback strategy.** While `npm run migrate:rollback` exists, the migration file does not implement `down` logic for complex tables, so rollbacks silently succeed without dropping schema, leading to mismatched environments during testing.【F:backend-nodejs/migrations/20241010120000_initial_schema.js†L1-L52】【F:backend-nodejs/package.json†L15-L26】
- **Operational tooling lacks visibility.** There is no schema change log, data dictionary, or ERD in the repo. Analysts and SREs must rely on reading migrations to decipher table purpose, undermining the “enterprise-ready” narrative.
- **JSON columns without schemas impede analytics.** Several tables (`communities.metadata`, `field_service_orders.metadata`, `runtime_configs.value`) store JSON blobs without validation or documentation, making BI tooling brittle and forcing analysts to reverse-engineer payloads from application code.【F:backend-nodejs/migrations/20241010120000_initial_schema.js†L25-L190】

## Errors
- **Seed truncation risks referential inconsistencies.** Mass `del()` calls rely on implicit cascade behaviour. If a new table lacks cascading deletes, the transaction will fail halfway through, leaving partially cleared data with minimal logging to indicate the failure point.【F:backend-nodejs/seeds/001_bootstrap.js†L7-L120】
- **Auto-increment counters are never reset.** Because seeds delete rows without truncating, repeated seeding increases primary keys indefinitely, breaking fixtures that expect deterministic IDs or causing overflow in integration tests that compare exact values.【F:backend-nodejs/seeds/001_bootstrap.js†L7-L120】
- **Environment validation can block CI unexpectedly.** The knex config throws when required env vars are absent. During CI, if secrets are injected after dependency install, migration scripts fail with a generic error before tests even start, increasing pipeline flakiness.【F:backend-nodejs/knexfile.cjs†L1-L18】
- **Lack of migration ordering safeguards.** With so many foreign keys, a missing `await` or newly added table can break transactional order. There are no automated checks or linters to ensure new migrations maintain referential integrity before hitting production.【F:backend-nodejs/migrations/20241010120000_initial_schema.js†L1-L198】
- **No guardrails on retention job data churn.** The data retention job deletes records by status and timestamp, but there are no dry-run or archival modes; a misconfigured policy could drop live data irreversibly.【F:backend-nodejs/src/jobs/dataRetentionJob.js†L56-L166】

## Integration
- **Application services assume full DB availability.** Startup applies migrations and then immediately launches jobs that depend on freshly provisioned tables (feature flags, retention policies, asset ingestion). There is no staging window to verify data readiness before business logic runs.【F:backend-nodejs/src/server.js†L1-L55】【F:backend-nodejs/src/jobs/dataRetentionJob.js†L56-L166】
- **Cross-domain data coupling complicates privacy requirements.** Tutoring, payments, analytics, and community engagement share the same schema and user IDs, making it difficult to satisfy regional data residency or per-feature opt-outs without significant refactoring.【F:backend-nodejs/migrations/20241010120000_initial_schema.js†L20-L198】
- **Seeds bake in third-party assumptions.** KYC documents reference Cloudflare buckets and hashed checksums, presuming R2 availability and specific storage conventions. Deployments on different storage providers must rewrite seeds to match their infrastructure.【F:backend-nodejs/seeds/001_bootstrap.js†L150-L198】
- **No change data capture or replication hooks.** Enterprise integrations often require CDC streams for analytics warehouses. The schema offers no triggers, timestamp auditing, or Debezium-ready metadata, so downstream systems must poll entire tables.【F:backend-nodejs/migrations/20241010120000_initial_schema.js†L1-L198】

## Security
- **Sensitive data stored without extra safeguards.** Tables for sessions, KYC documents, and payment ledgers hold personally identifiable information, yet there is no column-level encryption, key rotation, or auditing triggers—security relies entirely on application logic.【F:backend-nodejs/migrations/20241010120000_initial_schema.js†L90-L198】【F:backend-nodejs/seeds/001_bootstrap.js†L150-L198】
- **Seeds expose predictable credentials.** Demo accounts share a known password hash (`LaunchReady!2024`). Without mandatory rotation scripts, lower environments risk shipping with these credentials enabled, offering an easy entry point for attackers.【F:backend-nodejs/seeds/001_bootstrap.js†L78-L114】
- **Migration privileges exceed least privilege.** Running `db.migrate.latest()` at boot forces the runtime user to own schema-altering permissions indefinitely. A compromised process could drop or modify critical tables with no secondary approval flow.【F:backend-nodejs/src/server.js†L14-L22】
- **Auditability gaps.** There is no automated logging for who accessed KYC, payments, or retention tables beyond manual inserts. Enterprises expect tamper-evident audit trails, which our current schema does not provide.
- **JSON storage hides sensitive payloads.** Compliance teams cannot easily detect PII stored in JSON columns, raising the risk of regulatory breaches if data minimisation reviews miss embedded details.【F:backend-nodejs/migrations/20241010120000_initial_schema.js†L25-L198】

## Alignment
- **Data strategy lags behind platform messaging.** Marketing emphasises compliance, retention automation, and modular services, yet the schema is monolithic, lacks archival tiers, and cannot be partially deployed—misaligned with Version 1.50 commitments to enterprise clients.【F:backend-nodejs/migrations/20241010120000_initial_schema.js†L1-L198】【F:backend-nodejs/src/jobs/dataRetentionJob.js†L56-L166】
- **Documentation debt hinders onboarding.** Without ERDs, data contracts, or retention policies in the repo, customer success and analytics teams cannot self-serve insights, contradicting the “analytics-first” positioning.【F:backend-nodejs/seeds/001_bootstrap.js†L7-L198】
- **Lack of multi-tenant strategy conflicts with enterprise ambitions.** Tables rely on single-tenant IDs and global indexes; there is no tenant discriminator or row-level security, so hosting multiple institutions in one cluster is risky for Version 1.50.【F:backend-nodejs/migrations/20241010120000_initial_schema.js†L1-L198】
- **Recommended focus for the update.** Introduce schema modularisation (separate databases or schemas per domain), add rollback scripts, document data governance, enforce index standards, and provide configurable seed sets to align the data layer with enterprise standards for 1.50.
